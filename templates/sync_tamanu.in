#!/usr/bin/env bash

HOST=${sync_tamanu:host}
CREDS=${sync_tamanu:credentials}

SINCE_SERVICE_REQUEST=${sync_tamanu:sample_since}
SINCE_PATIENTS=${sync_tamanu:patients_since}

BASE=${buildout:directory}
BIN_DIR=${buildout:directory}/bin
SRC_DIR=${buildout:directory}/src
SRC=$SRC_DIR/palau.lims/scripts/sync_tamanu.py

# Synchronize service requests
$BIN_DIR/${sync_tamanu:zeoclient} run $SRC -th $HOST -tu $CREDS -r ServiceRequest -s $SINCE_SERVICE_REQUEST
exit_code=$?
if [ "${exit_code}" -ne 0 ]; then exit $exit_code; fi

# Synchronize patients
$BIN_DIR/${sync_tamanu:zeoclient} run $SRC -th $HOST -tu $CREDS -r Patient -s $SINCE_PATIENTS
exit_code=$?
if [ "${exit_code}" -ne 0 ]; then exit $exit_code; fi
